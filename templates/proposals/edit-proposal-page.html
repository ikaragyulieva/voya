<!--
Copyright (C) 2025 DROMO SA

This file is part of VOYA.

VOYA is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

VOYA is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <https://www.gnu.org/licenses/>.
-->

{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% load i18n %}


{% block content %}

    <div class="proposal">

        <!--Request, Internal comments and History -->
        <div class="trip-comments-wrapper">
        
            <!-- Request Section -->
            <div class="trip trip-proposal">
                <!-- Trip title -->
                <div class="trip-title">
                    <p>{{ current_request.slug }}</p>
                </div>

                <hr class="custom-line">

                <!-- Group Information section -->
                <div class="trip-section">
                    <h3 class="title">{% trans "Group Information" %}</h3>
                    <table>
                        <tbody>
                        <tr>
                            <th>{% trans "Nationality:" %}</th>
                            <td><i> {{ current_request.get_nationality_display }} </i></td>
                        </tr>
                        <tr>
                            <th>{% trans "Age range:" %}</th>
                            <td><i>{{ current_request.age_range }} {% trans "years old" %}</i></td>
                        </tr>
                        <tr>
                            <th>{% trans "Min participants:" %}</th>
                            <td><i> {{ current_request.min_participants }} {% trans "people" %}</i></td>
                        </tr>
                        <tr>
                            <th>{% trans "Max participants:" %}</th>
                            <td><i> {{ current_request.max_participants }} {% trans "people" %}</i></td>
                        </tr>
                        <tr>
                            <th>{% trans "Group type:" %}</th>
                            <td><i> {{ current_request.get_kind_of_group_display }} </i></td>
                        </tr>
                        {% if current_request.type_of_trip %}
                            <tr>
                                <th>{% trans "Type of trip:" %}</th>
                                <td><i> {{ current_request.type_of_trip }} </i></td>
                            </tr>
                        {% endif %}
                        {% if current_request.additional_observations %}
                            <tr>
                                <th>{% trans "Additional observations:" %}</th>
                                <td><i> {{ current_request.additional_observations }} </i></td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>

                <hr class="custom-line">

                <!-- Itinerary Information section -->
                <div class="trip-section">
                    <h3 class="title">{% trans "Dates Information" %}</h3>
                    <table>
                        <tbody>
                        <tr>
                            <th>{% trans "Start date:" %}</th>
                            <td><i> {{ current_request.trip_start_date }} </i></td>
                        </tr>
                        <tr>
                            <th>{% trans "End date:" %}</th>
                            <td><i>{{ current_request.trip_end_date }}</i></td>
                        </tr>
                        <tr>
                            <th>{% trans "Trip duration:" %}</th>
                            <td><i> {{ current_request.trip_duration }} {% trans "days" %} </i></td>
                        </tr>
                        </tbody>
                    </table>

                </div>

                <hr class="custom-line">

                <!-- Destination Information section -->
                <div class="trip-section">
                    <h3 class="title">{% trans "Destination Information:" %}</h3>

                    <table>
                        <tbody>
                        <tr>
                            <th>{% trans "Origin country:" %}</th>
                            <td><i> {{ current_request.get_country_origin_display }} </i></td>
                        </tr>
                        <tr>
                            <th>{% trans "Destinations:" %}</th>
                            <td><i>{{ current_request.get_country_destinations_display }}</i></td>
                        </tr>
                        {% if current_request.other_destinations %}
                            <tr>
                                <th>{% trans "Additional destinations info:" %}</th>
                                <td><i> {{ current_request.other_destinations }} </i></td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>

                <hr class="custom-line">

                <!-- Trip Information section -->
                <div class="trip-section">
                    <h3 class="title">{% trans "Trip Information:" %}</h3>

                    <table>
                        <tbody>
                        <tr>
                            <th>{% trans "Transportation:" %}</th>
                            <td><i> {{ current_request.get_transportation_type_display }} </i></td>
                        </tr>

                        {% if current_request.transportation_details %}
                            <tr>
                                <th>{% trans "Transportation details:" %}</th>
                                <td><i>{{ current_request.transportation_details }}</i></td>
                            </tr>
                        {% endif %}
                        <tr>
                            <th>{% trans "Accommodation:" %}</th>
                            <td><i> {{ current_request.get_accommodations_display }} </i></td>
                        </tr>
                        {% if current_request.accommodations_details %}
                            <tr>
                                <th>{% trans "Accommodation details:" %}</th>
                                <td><i> {{ current_request.accommodations_details }} </i></td>
                            </tr>
                        {% endif %}
                        <tr>
                            <th>{% trans "Meals:" %}</th>
                            <td><i> {{ current_request.get_meals_display }} </i></td>
                        </tr>
                        {% if current_request.meals_details %}
                            <tr>
                                <th>{% trans "Meals details:" %}</th>
                                <td><i> {{ current_request.meals_details }} </i></td>
                            </tr>
                        {% endif %}
                        <tr>
                            <th>{% trans "Staff:" %}</th>
                            <td><i> {{ current_request.get_staff_display }} </i></td>
                        </tr>
                        </tbody>
                    </table>

                </div>

                <hr class="custom-line">

                <!-- Billing Information section -->
                <div class="trip-section">
                    <h3 class="title">{% trans "Billing Information:" %}</h3>
                    <table>
                        <tbody>
                        <tr>
                            <th>{% trans "Budget:" %}</th>
                            <td>
                                <i> {{ current_request.budget }} {{ current_request.get_currency_display }} </i>
                            </td>
                        </tr>
                        <tr>
                            <th>{% trans "Currency:" %}</th>
                            <td><i>{{ current_request.get_currency_display }}</i></td>
                        </tr>
                        </tbody>
                    </table>

                </div>

            </div>


            <!--Internal comments box -->
            <div class="trip trip-proposal trip-internal-note">

                <div class="trip-section">
                    <h3 class="title">{% trans "Internal Comments" %}</h3>
                </div>
                <hr class="custom-line">
                <form id="proposal-form" method="post" action="#" onsubmit="return false" data-mode="edit"
                      data-proposal-id="{{ proposal.id }}" data-trip-id="{{ trip_id }}">
                    <div class="internal-note">
                        <textarea name="internal-comments" cols="40" rows="10" id="id_internal-comments"
                                  placeholder="{% trans 'Add internal notes here' %}">{{ proposal.internal_comments }} </textarea>
                    </div>
                </form>
            </div>
        </div>

        <!-- Trip Proposal Template -->
        <form id="proposal-form" method="post" action="#" onsubmit="return false" data-mode="edit"
              translate="no" data-proposal-id="{{ proposal.id }}" data-trip-id="{{ trip_id }}">
            {% csrf_token %}
            
            <div class="trip proposal-edit proposal-create">
                <!-- Proposal title -->
                <div class="trip-title">
                    <p><input name="title" type="text" placeholder="{% trans 'Add a title' %}" value="{{ proposal.title }}"></p>
                </div>
            
                <hr class="custom-line">
            
                <!-- Accommodation -->
                <div class="trip-section">
                    <h3 class="section-title title" data-section-key="Accommodations">{% trans "Accommodations" %}</h3>
                    
                    <!-- Add row button -->
                    <div class="action-btn add-option">
                        <a href="#" class="add-row-button">
                            <img
                                    src="{% static 'images/new-page.png' %}"
                                    alt='{% trans "Add row" %}'
                                    title='{% trans "Add row" %}'
                            />
                        </a>
                    </div>
                    
                    <ul class="responsive-table requests-table items-table">
                        <!-- Accommodation headers -->
                        <li class="table-header variable-cost">
                            <div class="col col-1">{% trans "Date" %}</div>
                            <div class="col col-2">{% trans "City" %}</div>
                            <div class="col col-33">{% trans "Service" %}</div>
                            <div class="col col-4">{% trans "Units" %}</div>
                            <div class="col col-5">{% trans "Price" %}</div>
                            <div class="col col-6 empty-space">Btn</div>
                        </li>
                        <!-- Accommodation rows -->
                        {% for item in accommodation_items %}
                            <li class="table-row" draggable="true" data-id="{{ item.id }}"
                                data-index="{{ forloop.counter0 }}">
                                
                                <div class="col col-1" data-label="date">
                                    <input type="text" name="corresponding_trip_date" id="id_corresponding_trip_date"
                                           class="flatpickr"
                                           placeholder="{% trans 'Select date' %}"
                                           value="{{ item.corresponding_trip_date|date:'Y-m-d' }}">
                                </div>
                            
                                <div class="col col-2" data-label="city">
                                    <select id="city-dropdown" name="city">
                                        {% for city in city_choices %}
                                            <option value="{{ city.id }}"
                                                    {% if city.id == item.city.id %}selected{% endif %}>
                                                {{ city.city_name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="{{ item.service_id }}" selected>{{ item.service_name }}</option>
                                        {% for service in available_services %}
                                            <option value="{{ service.id }}">{{ service.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-4" data-label="quantity">
                                    <input type="number"
                                           name="quantity"
                                           placeholder="0"
                                           value="{{ item.quantity }}">
                                </div>
                            
                                <div class="col col-5" data-label="variable cost">
                                    <input type="text"
                                           name="service_price"
                                           id="service-price"
                                           placeholder="€ 0.00"
                                           value="€ {{ item.price }}">
                                </div>
                            
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    <textarea name="description" class="description-field"
                                              placeholder='{% trans "Add additional details here..." %}'>{{ item.additional_notes }}</textarea>
                                </div>
                            </li>
                        {% empty %}
                            <li class="table-row">
                                <div class="col col-1 " data-label="date">
                                    {{ item_form.corresponding_trip_date }}
                                </div>
                                
                                <div class="col col-2" data-label="city">
                                    {{ item_form.city }}
                                </div>
                                
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="">{% trans "Select a Service" %}</option>
                                    </select>
                                </div>
                                
                                <div class="col col-4" data-label="quantity">
                                    {{ item_form.quantity|placeholder:'0' }}
                                </div>
                                <div class="col col-5" data-label="variable cost">
                                    <input type="text" id="service-price" name="service_price" placeholder="€ 0.00">
                                </div>
                                
                                <!-- Action buttons-->
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    {{ item_form.additional_notes|placeholder:"{% trans 'Add additional details here...' %}" }}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                
                    <!-- Totals row -->
                    <ul class="responsive-table">
                        <li class="table-totals-row">
                            <div class="col col-1"></div>
                            <div class="col col-2"></div>
                            <div class="col col-33"></div>
                            <div class="col col-4">{% trans "Total:" %}</div>
                            <div class="col col-5 table-total">{{ item_form.item_totals }}</div>
                            <div class="col col-6"></div>
                        </li>
                    </ul>
                </div>

                <!-- Meals -->
                <hr class="custom-line">
                <div class="trip-section">
                    <h3 class="section-title title" data-section-key="Meals">{% trans "Meals" %}</h3>
                   
                    <!-- Add row button -->
                    <div class="action-btn add-option">
                        <a href="#" class="add-row-button">
                            <img
                                    src="{% static 'images/new-page.png' %}"
                                    alt='{% trans "Add row" %}'
                                    title='{% trans "Add row" %}'
                            />
                        </a>
                    </div>

                    <ul class="responsive-table requests-table items-table">
                        <!-- Meals headers -->
                        <li class="table-header variable-cost">
                            <div class="col col-1">{% trans "Date" %}</div>
                            <div class="col col-2">{% trans "City" %}</div>
                            <div class="col col-33">{% trans "Service" %}</div>
                            <div class="col col-4">{% trans "Units" %}</div>
                            <div class="col col-5">{% trans "Price" %}</div>
                            <div class="col col-6 empty-space">Btn</div>

                        </li>
                        <!-- Meals rows -->
                        {% for item in meal_items %}
                            <li class="table-row" draggable="true" data-id="{{ item.id }}"
                                data-index="{{ forloop.counter0 }}">
                               
                                <div class="col col-1" data-label="date">
                                    <input type="text" name="corresponding_trip_date" id="id_corresponding_trip_date"
                                           class="flatpickr"
                                           placeholder="{% trans 'Select date' %}"
                                           value="{{ item.corresponding_trip_date|date:'Y-m-d' }}">
                                </div>
                            
                                <div class="col col-2" data-label="city">
                                    <select id="city-dropdown" name="city">
                                        {% for city in city_choices %}
                                            <option value="{{ city.id }}"
                                                    {% if city.id == item.city.id %}selected{% endif %}>
                                                {{ city.city_name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-33 note" data-label="service details">
                                    <select id="meal-dropdown" name="meal">
                                        <option value="{{ item.additional_notes }}" selected>
                                            {{ item.additional_notes }}
                                        </option>
                                        {% for meal_value in meal_options %}
                                            <option value="{{ meal_value }}">
                                                {{ meal_value }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-4" data-label="quantity">
                                    <input type="number"
                                           name="quantity"
                                           placeholder="0"
                                           value="{{ item.quantity }}">
                                </div>
                            
                                <div class="col col-5" data-label="variable cost">
                                    <input type="text"
                                           name="service_price"
                                           id="service-price"
                                           placeholder="€ 0.00"
                                           value="€ {{ item.price }}">
                                </div>
                            
                                <div class="col col-6" data-label="remove">
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>

                            </li>
                        {% empty %}
                            <li class="table-row">
                            
                                <div class="col col-1" data-label="date">
                                    {{ item_form.corresponding_trip_date }}
                                </div>
                            
                                <div class="col col-2" data-label="city">
                                    {{ item_form.city }}
                                </div>
                            
                                <div class="col col-33 note" data-label="service details">
                                    <select id="meal-dropdown" name="meal">
                                        <option value="">{% trans "Select an option" %}</option>
                                        {% for meal_value in meal_options %}
                                            <option value="{{ meal_value }}">{{ meal_value }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-4" data-label="quantity">
                                    {{ item_form.quantity|placeholder:'0' }}
                                </div>
                            
                                <div class="col col-5" data-label="price">
                                    <input type="text" id="service-price" name="service_price" placeholder="€ 0.00">
                                </div>

                                <!-- Remove Row-->
                                <div class="col col-6" data-label="remove">
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                
                <!-- Totals row -->
                    <ul class="responsive-table">
                        <li class="table-totals-row">
                            <div class="col col-1"></div>
                            <div class="col col-2"></div>
                            <div class="col col-33"></div>
                            <div class="col col-4">{% trans "Total:" %}</div>
                            <div class="col col-5 table-total">{{ item_form.item_totals }}</div>
                            <div class="col col-6"></div>
                        </li>
                    </ul>
                </div>

                <!-- Private Transport -->
                <hr class="custom-line">
                <div class="trip-section">
                    <h3 class="section-title title" data-section-key="Private Transport">{% trans "Private Transport" %}</h3>
                    
                    <!-- Add row button -->
                    <div class="action-btn add-option">
                        <a href="#" class="add-row-button">
                            <img
                                    src="{% static 'images/new-page.png' %}"
                                    alt='{% trans "Add row" %}'
                                    title='{% trans "Add row" %}'
                            />
                        </a>
                    </div>
                    <ul class="responsive-table requests-table items-table">
                        <!-- Private Transport headers -->
                        <li class="table-header fixed-cost">
                            <div class="col col-1">{% trans "Date" %}</div>
                            <div class="col col-2">{% trans "City" %}</div>
                            <div class="col col-33">{% trans "Service" %}</div>
                            <div class="col col-4">{% trans "Units" %}</div>
                            <div class="col col-5">{% trans "Price" %}</div>
                            <div class="col col-6 empty-space">Btn</div>
                        </li>
                        <!-- Private Transport rows -->
                        {% for item in private_transport_items %}
                            <li class="table-row" draggable="true" data-id="{{ item.id }}"
                                data-index="{{ forloop.counter0 }}">
                            
                                <div class="col col-1" data-label="date">
                                    <input type="text" name="corresponding_trip_date" id="id_corresponding_trip_date"
                                           class="flatpickr"
                                           placeholder="{% trans 'Select date' %}"
                                           value="{{ item.corresponding_trip_date|date:'Y-m-d' }}">
                                </div>
                            
                                <div class="col col-2" data-label="city">
                                    <select id="city-dropdown" name="city">
                                        {% for city in city_choices %}
                                            <option value="{{ city.id }}"
                                                    {% if city.id == item.city.id %}selected{% endif %}>
                                                {{ city.city_name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="{{ item.service_id }}" selected>{{ item.service_name }}</option>
                                        {% for service in available_services %}
                                            <option value="{{ service.id }}">{{ service.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-4" data-label="quantity">
                                    <input type="number"
                                           name="quantity"
                                           placeholder="0"
                                           value="{{ item.quantity }}">
                                </div>
                            
                                <div class="col col-5" data-label="variable cost">
                                    <input type="text"
                                           name="service_price"
                                           id="service-price"
                                           placeholder="€ 0.00"
                                           value="€ {{ item.price }}">
                                </div>
                                
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    <textarea name="description" class="description-field"
                                              placeholder= '{% trans "Add additional details here..." %}'>
                                        {{ item.additional_notes }}
                                    </textarea>
                                </div>
                            </li>
                            
                        {% empty %}
                            <li class="table-row">
                                <div class="col col-1" data-label="date">
                                    {{ item_form.corresponding_trip_date }}
                                </div>
                                
                                <div class="col col-2" data-label="city">
                                    {{ item_form.city }}
                                </div>
                                
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="">{% trans "Select a Service" %}</option>
                                    </select>
                                </div>
                                
                                <div class="col col-4" data-label="quantity">
                                    {{ item_form.quantity|placeholder:'0' }}
                                </div>
                                
                                <div class="col col-5" data-label="price">
                                    <input type="text" id="service-price" name="service_price" placeholder="€ 0.00">
                                </div>
                                
                                <!-- Action buttons-->
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    {{ item_form.additional_notes|placeholder:_('Add additional details here...') }}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                
                    <!-- Totals row -->
                    <ul class="responsive-table">
                        <li class="table-totals-row">
                            <div class="col col-1"></div>
                            <div class="col col-2"></div>
                            <div class="col col-33"></div>
                            <div class="col col-4">{% trans "Total:" %}</div>
                            <div class="col col-5 table-total">{{ item_form.item_totals }}</div>
                            <div class="col col-6"></div>
                        </li>
                    </ul>
                </div>

                <!-- Public Transport -->
                <hr class="custom-line">
                <div class="trip-section">
                    <h3 class="section-title title" data-section-key="Public Transport">{% trans "Public Transport" %}</h3>
                    
                    <!-- Add row button -->
                    <div class="action-btn add-option">
                        <a href="#" class="add-row-button">
                            <img
                                    src="{% static 'images/new-page.png' %}"
                                    alt='{% trans "Add row" %}'
                                    title='{% trans "Add row" %}'
                            />
                        </a>
                    </div>
                
                    <ul class="responsive-table requests-table items-table">
                        <!-- Public Transport headers -->
                        <li class="table-header variable-cost">
                            <div class="col col-1">{% trans "Date" %}</div>
                            <div class="col col-2">{% trans "City" %}</div>
                            <div class="col col-33">{% trans "Service" %}</div>
                            <div class="col col-4">{% trans "Units" %}</div>
                            <div class="col col-5">{% trans "Price" %}</div>
                            <div class="col col-6 empty-space">Btn</div>
                        </li>
                        <!-- Public Transport rows -->
                        {% for item in public_transport_items %}
                            <li class="table-row" draggable="true" data-id="{{ item.id }}"
                                data-index="{{ forloop.counter0 }}">
                                
                                <div class="col col-1" data-label="date">
                                    <input type="text" name="corresponding_trip_date" id="id_corresponding_trip_date"
                                           class="flatpickr"
                                           placeholder="{% trans 'Select date' %}"
                                           value="{{ item.corresponding_trip_date|date:'Y-m-d' }}">
                                </div>
                            
                                <div class="col col-2" data-label="city">
                                    <select id="city-dropdown" name="city">
                                        {% for city in city_choices %}
                                            <option value="{{ city.id }}"
                                                    {% if city.id == item.city.id %}selected{% endif %}>
                                                {{ city.city_name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="{{ item.service_id }}" selected>{{ item.service_name }}</option>
                                        {% for service in available_services %}
                                            <option value="{{ service.id }}">{{ service.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-4" data-label="quantity">
                                    <input type="number"
                                           name="quantity"
                                           placeholder="0"
                                           value="{{ item.quantity }}">
                                </div>
                            
                                <div class="col col-5" data-label="variable cost">
                                    <input type="text"
                                           name="service_price"
                                           id="service-price"
                                           placeholder="€ 0.00"
                                           value="€ {{ item.price }}">
                                </div>
                            
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    <textarea name="description" class="description-field"
                                              placeholder='{% trans "Add additional details here..." %}'>{{ item.additional_notes }}</textarea>
                                </div>
                            </li>
                            
                        {% empty %}

                            <li class="table-row">
                                <div class="col col-1" data-label="date">
                                    {{ item_form.corresponding_trip_date }}
                                </div>
                                
                                <div class="col col-2" data-label="city">
                                    {{ item_form.city }}
                                </div>
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="">{% trans "Select a Service" %}</option>
                                    </select>
                                </div>
                                
                                <div class="col col-4" data-label="quantity">
                                    {{ item_form.quantity|placeholder:'0' }}
                                </div>
                                
                                <div class="col col-5" data-label="price">
                                    <input type="text" id="service-price" name="service_price" placeholder="€ 0.00">
                                </div>
                                
                                <!-- Action buttons-->
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    {{ item_form.additional_notes|placeholder:_('Add additional details here...') }}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                
                    <!-- Totals row -->
                    <ul class="responsive-table">
                        <li class="table-totals-row">
                            <div class="col col-1"></div>
                            <div class="col col-2"></div>
                            <div class="col col-33"></div>
                            <div class="col col-4">{% trans "Total:" %}</div>
                            <div class="col col-5 table-total">{{ item_form.item_totals }}</div>
                            <div class="col col-6"></div>
                        </li>
                    </ul>
                </div>

                <!-- Activity -->
                <hr class="custom-line">
                <div class="trip-section">
                    <h3 class="section-title title" data-section-key="Activity">{% trans "Extra Activities" %}</h3>
                    
                    <!-- Add row button -->
                    <div class="action-btn add-option">
                        <a href="#" class="add-row-button">
                            <img
                                    src="{% static 'images/new-page.png' %}"
                                    alt='{% trans "Add row" %}'
                                    title='{% trans "Add row" %}'
                            />
                        </a>
                    </div>
                
                    <ul class="responsive-table requests-table items-table">
                        <!-- Activity headers -->
                        <li class="table-header variable-cost">
                            <div class="col col-1">{% trans "Date" %}</div>
                            <div class="col col-2">{% trans "City" %}</div>
                            <div class="col col-33">{% trans "Service" %}</div>
                            <div class="col col-4">{% trans "Units" %}</div>
                            <div class="col col-5">{% trans "Price" %}</div>
                            <div class="col col-6 empty-space">Btn</div>

                        </li>
                        <!-- Activity rows -->
                        {% for item in activity_items %}
                            <li class="table-row" draggable="true" data-id="{{ item.id }}"
                                data-index="{{ forloop.counter0 }}">
                            
                                <div class="col col-1" data-label="date">
                                    <input type="text" name="corresponding_trip_date" id="id_corresponding_trip_date"
                                           class="flatpickr"
                                           placeholder="{% trans 'Select date' %}"
                                           value="{{ item.corresponding_trip_date|date:'Y-m-d' }}">
                                </div>
                            
                                <div class="col col-2" data-label="city">
                                    <select id="city-dropdown" name="city">
                                        {% for city in city_choices %}
                                            <option value="{{ city.id }}"
                                                    {% if city.id == item.city.id %}selected{% endif %}>
                                                {{ city.city_name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="{{ item.service_id }}" selected>{{ item.service_name }}</option>
                                        {% for service in available_services %}
                                            <option value="{{ service.id }}">{{ service.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-4" data-label="quantity">
                                    <input type="number"
                                           name="quantity"
                                           placeholder="0"
                                           value="{{ item.quantity }}">
                                </div>
                                <div class="col col-5" data-label="variable cost">
                                    <input type="text"
                                           name="service_price"
                                           id="service-price"
                                           placeholder="€ 0.00"
                                           value="€ {{ item.price }}">
                                </div>
                            
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    <textarea name="description" class="description-field"
                                              placeholder='{% trans "Add additional details here..." %}'>{{ item.additional_notes }}</textarea>
                                </div>
                            </li>
                        
                        {% empty %}

                            <li class="table-row">
                                <div class="col col-1" data-label="date">
                                    {{ item_form.corresponding_trip_date }}
                                </div>
                                
                                <div class="col col-2" data-label="city">
                                    {{ item_form.city }}
                                </div>
                                
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="">{% trans "Select a Service" %}</option>
                                    </select>
                                </div>
                                
                                <div class="col col-4" data-label="quantity">
                                    {{ item_form.quantity|placeholder:'0' }}
                                </div>
                                <div class="col col-5" data-label="price">
                                    <input type="text" id="service-price" name="service_price" placeholder="€ 0.00">
                                </div>
                                
                                <!-- Action buttons-->
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    {{ item_form.additional_notes|placeholder:_('Add additional details here...') }}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                
                    <!-- Totals row -->
                    <ul class="responsive-table">
                        <li class="table-totals-row">
                            <div class="col col-1"></div>
                            <div class="col col-2"></div>
                            <div class="col col-33"></div>
                            <div class="col col-4">{% trans "Total:" %}</div>
                            <div class="col col-5 table-total">{{ item_form.item_totals }}</div>
                            <div class="col col-6"></div>
                        </li>
                    </ul>
                </div>

                <!-- Transfers -->
                <hr class="custom-line">
                <div class="trip-section">
                    <h3 class="section-title title" data-section-key="Transfers">{% trans "Transfers" %}</h3>
                    
                    <!-- Add row button -->
                    <div class="action-btn add-option">
                        <a href="#" class="add-row-button">
                            <img
                                    src="{% static 'images/new-page.png' %}"
                                    alt='{% trans "Add row" %}'
                                    title='{% trans "Add row" %}'
                            />
                        </a>
                    </div>
                    <ul class="responsive-table requests-table items-table">
                        <!-- Transfers headers -->
                        <li class="table-header fixed-cost">
                            <div class="col col-1">{% trans "Date" %}</div>
                            <div class="col col-2">{% trans "City" %}</div>
                            <div class="col col-33">{% trans "Service" %}</div>
                            <div class="col col-4">{% trans "Units" %}</div>
                            <div class="col col-5">{% trans "Price" %}</div>
                            <div class="col col-6 empty-space">Btn</div>

                        </li>
                        <!-- Transfers rows -->
                        {% for item in transfer_items %}
                            <li class="table-row" draggable="true" data-id="{{ item.id }}"
                                data-index="{{ forloop.counter0 }}">
                            
                                <div class="col col-1" data-label="date">
                                    <input type="text" name="corresponding_trip_date" id="id_corresponding_trip_date"
                                           class="flatpickr"
                                           placeholder="{% trans 'Select date' %}"
                                           value="{{ item.corresponding_trip_date|date:'Y-m-d' }}">
                                </div>
                            
                                <div class="col col-2" data-label="city">
                                    <select id="city-dropdown" name="city">
                                        {% for city in city_choices %}
                                            <option value="{{ city.id }}"
                                                    {% if city.id == item.city.id %}selected{% endif %}>
                                                {{ city.city_name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="{{ item.service_id }}" selected>{{ item.service_name }}</option>
                                        {% for service in available_services %}
                                            <option value="{{ service.id }}">{{ service.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-4" data-label="quantity">
                                    <input type="number"
                                           name="quantity"
                                           placeholder="0"
                                           value="{{ item.quantity }}">
                                </div>
                            
                                <div class="col col-5" data-label="variable cost">
                                    <input type="text"
                                           name="service_price"
                                           id="service-price"
                                           placeholder="€ 0.00"
                                           value="€ {{ item.price }}">
                                </div>
                            
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    <textarea name="description" class="description-field"
                                              placeholder='{% trans "Add additional details here..." %}'>{{ item.additional_notes }}</textarea>
                                </div>
                            </li>

                        {% empty %}
                            <li class="table-row">
                                <div class="col col-1" data-label="date">
                                    {{ item_form.corresponding_trip_date }}
                                </div> 
                                
                                <div class="col col-2" data-label="city">
                                    {{ item_form.city }}
                                </div>
                                
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="">{% trans "Select a Service" %}</option>
                                    </select>
                                </div>
                                
                                <div class="col col-4" data-label="quantity">
                                    {{ item_form.quantity|placeholder:'0' }}
                                </div>
                                
                                <div class="col col-5" data-label="price">
                                    <input type="text" id="service-price" name="service_price" placeholder="€ 0.00">
                                </div>
                                
                                <!-- Action buttons-->
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    {{ item_form.additional_notes|placeholder:_('Add additional details here...') }}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                
                    <!-- Totals row -->
                    <ul class="responsive-table">
                        <li class="table-totals-row">
                            <div class="col col-1"></div>
                            <div class="col col-2"></div>
                            <div class="col col-33"></div>
                            <div class="col col-4">{% trans "Total:" %}</div>
                            <div class="col col-5 table-total">{{ item_form.item_totals }}</div>
                            <div class="col col-6"></div>
                        </li>
                    </ul>
                </div>

                <!-- Local Guides -->
                <hr class="custom-line">
                <div class="trip-section">
                    <h3 class="section-title title" data-section-key="Local Guides">{% trans "Local Guides" %}</h3>
                   
                    <!-- Add row button -->
                    <div class="action-btn add-option">
                        <a href="#" class="add-row-button">
                            <img
                                    src="{% static 'images/new-page.png' %}"
                                    alt='{% trans "Add row" %}'
                                    title='{% trans "Add row" %}'
                            />
                        </a>
                    </div>

                    <ul class="responsive-table requests-table items-table">
                        <!-- Local Guides headers -->
                        <li class="table-header fixed-cost">
                            <div class="col col-1">{% trans "Date" %}</div>
                            <div class="col col-2">{% trans "City" %}</div>
                            <div class="col col-33">{% trans "Service" %}</div>
                            <div class="col col-4">{% trans "Units" %}</div>
                            <div class="col col-5">{% trans "Price" %}</div>
                            <div class="col col-6 empty-space">Btn</div>

                        </li>
                        <!-- Local Guides rows -->
                        {% for item in guides_items %}
                            <li class="table-row" draggable="true" data-id="{{ item.id }}"
                                data-index="{{ forloop.counter0 }}">
                                
                                <div class="col col-1" data-label="date">
                                    <input type="text" name="corresponding_trip_date" id="id_corresponding_trip_date"
                                           class="flatpickr"
                                           placeholder="{% trans 'Select date' %}"
                                           value="{{ item.corresponding_trip_date|date:'Y-m-d' }}">
                                </div>
                            
                                <div class="col col-2" data-label="city">
                                    <select id="city-dropdown" name="city">
                                        {% for city in city_choices %}
                                            <option value="{{ city.id }}"
                                                    {% if city.id == item.city.id %}selected{% endif %}>
                                                {{ city.city_name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="{{ item.service_id }}" selected>{{ item.service_name }}</option>
                                        {% for service in available_services %}
                                            <option value="{{ service.id }}">{{ service.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-4" data-label="quantity">
                                    <input type="number"
                                           name="quantity"
                                           placeholder="0"
                                           value="{{ item.quantity }}">
                                </div>
                            
                                <div class="col col-5" data-label="variable cost">
                                    <input type="text"
                                           name="service_price"
                                           id="service-price"
                                           placeholder="€ 0.00"
                                           value="€ {{ item.price }}">
                                </div>
                            
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    <textarea name="description" class="description-field"
                                              placeholder='{% trans "Add additional details here..." %}'>{{ item.additional_notes }}</textarea>
                                </div>
                            </li>

                        {% empty %}

                            <li class="table-row">
                                <div class="col col-1" data-label="date">
                                    {{ item_form.corresponding_trip_date }}
                                </div>
                                
                                <div class="col col-2" data-label="city">
                                    {{ item_form.city }}
                                </div>
                                
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="">{% trans "Select a Service" %}</option>
                                    </select>
                                </div>
                                
                                <div class="col col-4" data-label="quantity">
                                    {{ item_form.quantity|placeholder:'0' }}
                                </div>
                                <div class="col col-5" data-label="price">
                                    <input type="text" id="service-price" name="service_price" placeholder="€ 0.00">
                                </div>

                                <!-- Action buttons-->
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    {{ item_form.additional_notes|placeholder:_('Add additional details here...') }}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                
                    <!-- Totals row -->
                    <ul class="responsive-table">
                        <li class="table-totals-row">
                            <div class="col col-1"></div>
                            <div class="col col-2"></div>
                            <div class="col col-33"></div>
                            <div class="col col-4">{% trans "Total:" %}</div>
                            <div class="col col-5 table-total">{{ item_form.item_totals }}</div>
                            <div class="col col-6"></div>
                        </li>
                    </ul>
                </div>

                <!-- Tour Leader -->
                <hr class="custom-line">
                <div class="trip-section">
                    <h3 class="section-title title" data-section-key="Tour Leader">{% trans "Tour Leader" %}</h3>
                    
                    <!-- Add row button -->
                    <div class="action-btn add-option">
                        <a href="#" class="add-row-button">
                            <img
                                    src="{% static 'images/new-page.png' %}"
                                    alt='{% trans "Add row" %}'
                                    title='{% trans "Add row" %}'
                            />
                        </a>
                    </div>

                    <ul class="responsive-table requests-table items-table">
                        <!-- Tour Leader headers -->
                        <li class="table-header fixed-cost">
                            <div class="col col-1">{% trans "Date" %}</div>
                            <div class="col col-2">{% trans "City" %}</div>
                            <div class="col col-33">{% trans "Service" %}</div>
                            <div class="col col-4">{% trans "Units" %}</div>
                            <div class="col col-5">{% trans "Price" %}</div>
                            <div class="col col-6 empty-space">Btn</div>

                        </li>
                        <!-- Tour Leader rows -->
                        {% for item in tour_leader_items %}
                            <li class="table-row" draggable="true" data-id="{{ item.id }}"
                                data-index="{{ forloop.counter0 }}">
                            
                                <div class="col col-1" data-label="date">
                                    <input type="text" name="corresponding_trip_date"
                                           id="id_corresponding_trip_date"
                                           class="flatpickr"
                                           placeholder="{% trans 'Select date' %}"
                                           value="{{ item.corresponding_trip_date|date:'Y-m-d' }}">
                                </div>
                            
                                <div class="col col-2" data-label="city">
                                    <select id="city-dropdown" name="city">
                                        {% for city in city_choices %}
                                            <option value="{{ city.id }}"
                                                    {% if city.id == item.city.id %}selected{% endif %}>
                                                {{ city.city_name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="{{ item.service_id }}"
                                                selected>{{ item.service_name }}</option>
                                        {% for service in available_services %}
                                            <option value="{{ service.id }}">{{ service.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-4" data-label="quantity">
                                    <input type="number"
                                           name="quantity"
                                           placeholder="0"
                                           value="{{ item.quantity }}">
                                </div>
                            
                                <div class="col col-5" data-label="variable cost">
                                    <input type="text"
                                           name="service_price"
                                           id="service-price"
                                           placeholder="€ 0.00"
                                           value="€ {{ item.price }}">
                                </div>
                            
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    <textarea name="description" class="description-field"
                                              placeholder='{% trans "Add additional details here..." %}'>{{ item.additional_notes }}</textarea>
                                </div>
                            </li>

                        {% empty %}

                            <li class="table-row">
                                <div class="col col-1" data-label="date">
                                    {{ item_form.corresponding_trip_date }}
                                </div>
                                
                                <div class="col col-2" data-label="city">
                                    {{ item_form.city }}
                                </div>
                                
                                <div class="col col-33" data-label="service details">
                                    <select id="service-dropdown" name="service">
                                        <option value="">{% trans "Select a Service" %}</option>
                                    </select>
                                </div>
                                
                                <div class="col col-4" data-label="quantity">
                                    {{ item_form.quantity|placeholder:'0' }}
                                </div>
                                
                                <div class="col col-5" data-label="price">
                                    <input type="text" id="service-price" name="service_price" placeholder="€ 0.00">
                                </div>

                                <!-- Action buttons-->
                                <div class="col col-6" data-label="actions">
                                    <!-- Description button-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="toggle-description-btn">
                                            <img
                                                    src="{% static 'images/down-arrow.png' %}"
                                                    alt='{% trans "toggle description" %}'
                                                    title='{% trans "Add description" %}'
                                                    data-open="{% static 'images/arrow-up.png' %}"
                                                    data-close="{% static 'images/down-arrow.png' %}"
                                            />
                                        </a>
                                    </div>
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                            
                            <!-- Hidden description row -->
                            <li class="table-row description-row" style="display: none;">
                                <div class="col col-full">
                                    {{ item_form.additional_notes|placeholder:_('Add additional details here...') }}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                
                    <!-- Totals row -->
                    <ul class="responsive-table">
                        <li class="table-totals-row">
                            <div class="col col-1"></div>
                            <div class="col col-2"></div>
                            <div class="col col-33"></div>
                            <div class="col col-4">{% trans "Total:" %}</div>
                            <div class="col col-5 table-total">{{ item_form.item_totals }}</div>
                            <div class="col col-6"></div>
                        </li>
                    </ul>
                </div>


                <!-- Other Services - Variable -->
                <hr class="custom-line">
                <div class="trip-section">
                    <h3 class="section-title title" data-section-key="Other Services - Variable">{% trans "Other Services - Variable" %}</h3>
                    
                    <!-- Add row button -->
                    <div class="action-btn add-option">
                        <a href="#" class="add-row-button">
                            <img
                                    src="{% static 'images/new-page.png' %}"
                                    alt='{% trans "Add row" %}'
                                    title='{% trans "Add row" %}'
                            />
                        </a>
                    </div>

                    <ul class="responsive-table requests-table items-table">
                        <!-- Other Services - Variable headers -->
                        <li class="table-header variable-cost">
                            <div class="col col-1">{% trans "Date" %}</div>
                            <div class="col col-2">{% trans "City" %}</div>
                            <div class="col col-33">{% trans "Service" %}</div>
                            <div class="col col-4">{% trans "Units" %}</div>
                            <div class="col col-5">{% trans "Price" %}</div>
                            <div class="col col-6 empty-space">Btn</div>

                        </li>
                        <!-- Other Services - Variable rows -->
                        {% for item in other_variable_items %}
                            <li class="table-row" draggable="true" data-id="{{ item.id }}"
                                data-index="{{ forloop.counter0 }}">
                                
                                <div class="col col-1" data-label="date">
                                    <input type="text" name="corresponding_trip_date" id="id_corresponding_trip_date"
                                           class="flatpickr"
                                           placeholder="{% trans 'Select date' %}"
                                           value="{{ item.corresponding_trip_date|date:'Y-m-d' }}">
                                </div>
                            
                                <div class="col col-2" data-label="city">
                                    <select id="city-dropdown" name="city">
                                        {% for city in city_choices %}
                                            <option value="{{ city.id }}"
                                                    {% if city.id == item.city.id %}selected{% endif %}>
                                                {{ city.city_name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-33 note" data-label="service details">
                                    <textarea
                                            name="additional_notes" cols="40" rows="10"
                                            id="id_additional_notes"
                                            placeholder="{% trans 'Add service' %}">{{ item.additional_notes }} </textarea>
                                </div>
                            
                                <div class="col col-4" data-label="quantity">
                                    <input type="number"
                                           name="quantity"
                                           placeholder="0"
                                           value="{{ item.quantity }}">
                                </div>
                            
                                <div class="col col-5" data-label="variable cost">
                                    <input type="text"
                                           name="service_price"
                                           id="service-price"
                                           placeholder="€ 0.00"
                                           value="€ {{ item.price }}">
                                </div>
                            
                                <div class="col col-6" data-label="remove">
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>

                            </li>

                        {% empty %}
                            
                            <li class="table-row">
                                <div class="col col-1" data-label="date">
                                    {{ item_form.corresponding_trip_date }}
                                </div>
                                
                                <div class="col col-2" data-label="city">
                                    {{ item_form.city }}
                                </div>
                                
                                <div class="col col-33 note" data-label="service details">
                                    {{ item_form.additional_notes|placeholder:_('Add service') }}
                                </div>
                                <div class="col col-4" data-label="quantity">
                                    {{ item_form.quantity|placeholder:'0' }}
                                </div>
                                <div class="col col-5" data-label="price">
                                    <input type="text" id="service-price" name="service_price" placeholder="€ 0.00">
                                </div>
                                
                                <div class="col col-6" data-label="remove">
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                    
                    <!-- Totals row -->
                    <ul class="responsive-table">
                        <li class="table-totals-row">
                            <div class="col col-1"></div>
                            <div class="col col-2"></div>
                            <div class="col col-33"></div>
                            <div class="col col-4">{% trans "Total:" %}</div>
                            <div class="col col-5 table-total">{{ item_form.item_totals }}</div>
                            <div class="col col-6"></div>
                        </li>
                    </ul>
                </div>


                <!-- Other Services - Fixed -->
                <hr class="custom-line">
                <div class="trip-section">
                    <h3 class="section-title title" data-section-key="Other Services - Fixed">{% trans "Other Services - Fixed" %} </h3>
                    
                    <!-- Add row button -->
                    <div class="action-btn add-option">
                        <a href="#" class="add-row-button">
                            <img
                                    src="{% static 'images/new-page.png' %}"
                                    alt='{% trans "Add row" %}'
                                    title='{% trans "Add row" %}'
                            />
                        </a>
                    </div>

                    <ul class="responsive-table requests-table items-table">
                        <!-- Other Services - Fixed headers -->
                        <li class="table-header fixed-cost">
                            <div class="col col-1">{% trans "Date" %}</div>
                            <div class="col col-2">{% trans "City" %}</div>
                            <div class="col col-33">{% trans "Service" %}</div>
                            <div class="col col-4">{% trans "Units" %}</div>
                            <div class="col col-5">{% trans "Price" %}</div>
                            <div class="col col-6 empty-space">Btn</div>

                        </li>
                        <!-- Other Services - Fixed rows -->
                        {% for item in other_fixed_items %}
                            <li class="table-row" draggable="true" data-id="{{ item.id }}"
                                data-index="{{ forloop.counter0 }}">
                            
                                <div class="col col-1" data-label="date">
                                    <input type="text" name="corresponding_trip_date" id="id_corresponding_trip_date"
                                           class="flatpickr"
                                           placeholder="{% trans 'Select date' %}"
                                           value="{{ item.corresponding_trip_date|date:'Y-m-d' }}">
                                </div>
                            
                                <div class="col col-2" data-label="city">
                                    <select id="city-dropdown" name="city">
                                        {% for city in city_choices %}
                                            <option value="{{ city.id }}"
                                                    {% if city.id == item.city.id %}selected{% endif %}>
                                                {{ city.city_name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            
                                <div class="col col-33 note" data-label="service details">
                                    <textarea
                                            name="additional_notes" cols="40" rows="10"
                                            id="id_additional_notes"
                                            placeholder="{% trans 'Add service' %}">{{ item.additional_notes }} </textarea>
                                </div>
                            
                                <div class="col col-4" data-label="quantity">
                                    <input type="number"
                                           name="quantity"
                                           placeholder="0"
                                           value="{{ item.quantity }}">
                                </div>
                            
                                <div class="col col-5" data-label="variable cost">
                                    <input type="text"
                                           name="service_price"
                                           id="service-price"
                                           placeholder="€ 0.00"
                                           value="€ {{ item.price }}">
                                </div>
                            
                                <div class="col col-6" data-label="remove">
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>

                        {% empty %}
                            
                            <li class="table-row" draggable="true" data-index="{{ forloop.counter0 }}">
                                
                                <div class="col col-1" data-label="date">
                                    {{ item_form.corresponding_trip_date }}
                                </div>
                                
                                <div class="col col-2" data-label="city">
                                    {{ item_form.city }}
                                </div>
                                <div class="col col-33 note" data-label="service details">
                                    {{ item_form.additional_notes|placeholder:_('Add service') }}
                                </div>
                                
                                <div class="col col-4" data-label="quantity">
                                    {{ item_form.quantity|placeholder:'0' }}
                                </div>
                                
                                <div class="col col-5" data-label="price">
                                    <input type="text" id="service-price" name="service_price" placeholder="€ 0.00">
                                </div>
                                
                                <div class="col col-6" data-label="remove">
                                    <!-- Remove Row-->
                                    <div class="action-btn request-action-btn proposal-item-btn">
                                        <a href="#" class="remove-row-button">
                                            <img
                                                    src="{% static 'images/close.png' %}"
                                                    alt='{% trans "remove row button" %}'
                                                    title='{% trans "Remove row" %}'
                                            />
                                        </a>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                
                    <!-- Totals row -->
                    <ul class="responsive-table">
                        <li class="table-totals-row">
                            <div class="col col-1"></div>
                            <div class="col col-2"></div>
                            <div class="col col-33"></div>
                            <div class="col col-4">{% trans "Total:" %}</div>
                            <div class="col col-5 table-total">{{ item_form.item_totals }}</div>
                            <div class="col col-6"></div>
                        </li>
                    </ul>

                </div>
            </div>
        </form>


        <!-- Trip Proposal Budget Template -->
        <div class="trip trip-proposal budget">

            <!-- Budget title -->
            <div class="trip-title">
                <p>{% trans "Proposal Budget" %}</p>
            </div>

            <hr class="custom-line">
        
            <div class="trip-section budget-section">
                <form id="proposal-form" method="post" action="#" onsubmit="return false" translate="no">
                    {% csrf_token %}
                
                    <!-- Buttons section -->
                    <div class="state-save-btn">
                        <!-- State -->
                        <div class="prop-status">
                            <p>{% trans "State:" context "proposal_status" %}</p>
                            <p id="draft-status">
                                <select id="id_status" name="status">
                                    {% for status_value, status_label in status_choices %}
                                        <option value="{{ status_value }}"
                                                {% if status_value == proposal.status %}selected{% endif %}>
                                            {{ status_label }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </p>

                        </div>
                        <!-- Action Buttons -->
                        <div class="action-btn request-action-btn proposal-action-btn">
                            <a href="{% url 'proposal_download' pk=proposal.pk %}"
                               class="action-link delete-link">
                                <img
                                        src="{% static 'images/download.png' %}"
                                        alt='{% trans "Download button" %}'
                                        title='{% trans "Download" %}'
                                />

                            </a>

                            <button id="submit-proposal-btn" class="top-btn" type="submit">
                                <img
                                        src="{% static 'images/save (1).png' %}"
                                        alt='{% trans "Save proposal" %}'
                                        title='{% trans "Save proposal" %}'
                                />
                            </button>
                            
                            <button id="save-and-check-btn" class="top-btn" type="submit">
                                <img
                                        src="{% static 'images/save.png' %}"
                                        alt='{% trans "Save & check proposal" %}'
                                        title='{% trans "Save & check proposal" %}'
                                />
                            </button>
                            
                        </div>
                    </div>

                    <!-- Budget table section -->
                    <div class="budget-container">
                        <table class="budget-table" id="budget-table">

                            <thead>
                            <tr>
                                <th></th>
                                <th data-id="{{ budget_id_min }}">{{ current_request.min_participants }} pax</th>
                                <th data-id="{{ budget_id_max }}">{{ current_request.max_participants }} pax</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <th>{% trans "Variable cost:" %}</th>
                                <td><i> {{ budget_form.variable_cost }} € </i></td>
                                <td><i> {{ budget_form.variable_cost }} € </i></td>
                            </tr>
                            <tr>
                                <th class="fixed-cost">{% trans "Fixed cost:" %}</th>
                                <td><i> {{ budget_form.fixed_cost }} € </i></td>
                                <td><i> {{ budget_form.fixed_cost }} € </i></td>
                            </tr>

                            <tr>
                                <th>
                                    {% trans "FOC:" %} &nbsp; &nbsp; <input type="number" id="foc-input" name="free_of_charge"
                                                              min="0"
                                                              placeholder="0"
                                                              value="{{ foc_pax }}"> &nbsp;pax
                                </th>
                                <td><i> {{ budget_form.free_of_charge_amount }} € </i></td>
                                <td><i> {{ budget_form.free_of_charge_amount }} € </i></td>
                            </tr>

                            <tr>
                                <th>{% trans "Total per PAX:" %}</th>
                                <td><i> {{ budget_form.total_cost_per_person }} € </i></td>
                                <td><i> {{ budget_form.total_cost_per_person }} € </i></td>
                            </tr>

                            <tr>
                                <th>{% trans "Total Cost:" %}</th>
                                <td><i> {{ budget_form.total_cost }} € </i></td>
                                <td><i> {{ budget_form.total_cost }} € </i></td>
                            </tr>

                            <tr>
                                <th>{% trans "Service fee:" %}</th>
                                {% for budget_option in budget %}
                                    <td><i> €
                                        <input type="text" inputmode="decimal"
                                               name="service-fee"
                                               placeholder="500.00"
                                               value="{{ budget_option.service_fee }}">
                                    </i></td>
                                {% endfor %}
                            </tr>
                            <tr>
                                <th>{% trans "Markup:" %}</th>
                                {% for budget_option in budget %}
                                    <td><i>
                                        <input type="number"
                                               name="margin"
                                               placeholder="10"
                                               value="{{ budget_option.margin }}"> %
                                    </i></td>
                                {% endfor %}
                            </tr>

                            </tbody>


                            <tfoot>
                            <tr>
                                <th>{% trans "Price per PAX:" %}</th>
                                <td><i> {{ budget_form.fina_price_per_person }} € </i></td>
                                <td><i> {{ budget_form.fina_price_per_person }} € </i></td>
                            </tr>
                            <tr>
                                <th>{% trans "Final Price:" %}</th>
                                {#                            <td><i> total € </i></td>#}
                                <td><i> {{ budget_form.fina_price }} € </i></td>
                                <td><i> {{ budget_form.fina_price }} € </i></td>
                            </tr>
                            </tfoot>

                        </table>
                    </div>
                </form>

            </div>

        </div>
    </div>

{% endblock %}

{% block scripts %}
    <script>window.reverseSectionKeys = {{reverse_section_keys|safe}}</script>
    <script src="{% static 'js/create-edit-proposal-functionalities.js' %}" defer></script>
    <script src="{% static 'js/toggle-row.js' %}"></script>
    <!-- flatpikr setup-->
    <script src="{% static 'js/date-formatting.js' %}"></script>
    <script src="{% static 'js/saving-settings.js' %}"></script>
{% endblock %}
